import{s as T,J as X,K as G,L as R,r as q,c as p,M as v,g as l,f as e,j as m,d as I,N as Y,O as Z,P as B,l as L,m as P,n as h,E as O,Q as ee,R as le,e as M,S as x,G as r}from"./index-dd5480ba.js";import{E as ae}from"./el-pagination-8bd51a4b.js";import{a as A,E as J}from"./el-table-column-af935453.js";import{E as te,a as oe}from"./el-select-52d117f3.js";import{E as ne,a as se}from"./el-col-61c74ea7.js";import{u as ue}from"./page-0eaa0be3.js";import{E as re,a as ie}from"./el-radio-7f61db63.js";import{v as de}from"./directive-a9448ffa.js";import{E as me}from"./index-fb28953f.js";import"./index-63153d31.js";function pe(s){return T({url:"/project",params:s})}function ce(s){return T({url:"/project",method:"post",data:s})}function _e(s,E){return T({url:"/project/"+s,method:"put",data:E})}function fe(s){return T({url:"/project/"+s,method:"delete"})}const ge={__name:"add-edit-dialog",props:{visible:{type:Boolean},visibleModifiers:{},formData:{type:Object},formDataModifiers:{}},emits:X(["done"],["update:visible","update:formData"]),setup(s,{emit:E}){const S=G(),b=E,c=R(s,"visible"),t=R(s,"formData"),V=q(),z=async()=>{await V.value.validate();for(const i in t.value.params)if(t.value.params[i].name==""||t.value.params[i].value=="")return B.error("参数名和参数值必填");t.value.id==0?await ce(t.value):await _e(t.value.id,t.value),c.value=!1,b("done"),S.getProject(),B.success("成功")};return(i,o)=>{const d=L,_=P,D=re,w=ie,y=h,C=A,f=oe,n=te,k=J,U=O,F=ee;return p(),v(F,{title:t.value.id==0?"添加项目":"编辑项目",modelValue:c.value,"onUpdate:modelValue":o[9]||(o[9]=a=>c.value=a),"close-on-click-modal":!1,width:"50%"},{footer:l(()=>[e(y,{onClick:o[7]||(o[7]=a=>c.value=!1)},{default:l(()=>[m("取 消")]),_:1}),e(y,{type:"primary",onClick:o[8]||(o[8]=a=>z())},{default:l(()=>[m("确 定")]),_:1})]),default:l(()=>[e(U,{ref_key:"elFormRef",ref:V,model:t.value,"label-width":"160px"},{default:l(()=>[e(_,{label:"项目名",rules:{required:!0,trigger:"blur",message:"请输入项目名"},prop:"name"},{default:l(()=>[e(d,{modelValue:t.value.name,"onUpdate:modelValue":o[0]||(o[0]=a=>t.value.name=a)},null,8,["modelValue"])]),_:1}),e(_,{label:"项目描述",rules:{required:!0,trigger:"blur",message:"请输入项目描述"},prop:"desc"},{default:l(()=>[e(d,{modelValue:t.value.desc,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.desc=a)},null,8,["modelValue"])]),_:1}),e(_,{label:"GIT地址",rules:{required:!0,trigger:"blur",message:"请输入GIT地址"},prop:"git"},{default:l(()=>[e(d,{modelValue:t.value.git,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.git=a)},null,8,["modelValue"])]),_:1}),e(_,{label:"用户名",rules:{required:!0,trigger:"blur",message:"请输入用户名"},prop:"userName"},{default:l(()=>[e(d,{modelValue:t.value.userName,"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.userName=a)},null,8,["modelValue"])]),_:1}),e(_,{label:"密码/token",rules:{required:t.value.id==0,trigger:"blur",message:"请输入密码"},prop:"token"},{default:l(()=>[e(d,{modelValue:t.value.token,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.token=a),placeholder:t.value.id==0?"":"不填写则不修改"},null,8,["modelValue","placeholder"])]),_:1},8,["rules"]),e(_,{label:"使用 TAG 更新版本",rules:{required:!0,trigger:"blur",type:"enum",enum:[0,1],message:"请设置使用TAG更新版本"},prop:"useTag"},{default:l(()=>[e(w,{modelValue:t.value.useTag,"onUpdate:modelValue":o[5]||(o[5]=a=>t.value.useTag=a)},{default:l(()=>[e(D,{label:0,border:""},{default:l(()=>[m("使用 latest")]),_:1}),e(D,{label:1,border:""},{default:l(()=>[m("使用指定 tag")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"预设变量"},{default:l(()=>[e(y,{type:"success",size:"small",onClick:o[6]||(o[6]=a=>t.value.params.push({}))},{default:l(()=>[m("新增")]),_:1}),e(k,{border:"",style:{"margin-top":"10px"},size:"small",data:t.value.params},{default:l(()=>[e(C,{align:"center",label:"参数名",prop:"name"},{default:l(({row:a})=>[e(d,{modelValue:a.name,"onUpdate:modelValue":u=>a.name=u,disabled:a.name=="tag",size:"small"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),e(C,{align:"center",label:"参数值",prop:"desc"},{default:l(({row:a})=>[a.name=="tag"?(p(),v(n,{key:0,size:"small",modelValue:a.value,"onUpdate:modelValue":u=>a.value=u,style:{width:"100%"}},{default:l(()=>[(p(!0),I(Z,null,Y(a.options,(u,N)=>(p(),v(f,{key:N,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),v(d,{key:1,modelValue:a.value,"onUpdate:modelValue":u=>a.value=u,size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),e(C,{align:"center",width:"170px",label:"操作"},{default:l(({$index:a})=>[e(y,{size:"small",type:"danger",onClick:u=>t.value.params.splice(a,1)},{default:l(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},ve={class:"app-container"},be=M("p",{class:"page-title"},"项目列表",-1),Ve={class:"filter-container"},ye={class:"page-container"},we={__name:"index",setup(s){const E=G(),S=()=>({id:0,name:"",desc:"",git:"",userName:"",token:"",useTag:"",params:[{name:"app_name",value:""},{name:"port",value:"8888"}]}),b=q(!1),c=q({}),t=async()=>{V.value=!0;const{data:f}=await pe(i.value);z.value=f.data,d.value=f.total,V.value=!1},{tableLoading:V,list:z,params:i,pageSizes:o,total:d,handleSizeChange:_,handleCurrentChange:D}=ue(t),w=()=>{b.value=!0,c.value=S()},y=async f=>{b.value=!0,Object.assign(c.value,f)},C=async f=>{await me.confirm("删除项目不可恢复","警告");const{message:n}=await fe(f.id);B.success(n),t(),E.getProject()};return(f,n)=>{const k=h,U=se,F=L,a=P,u=O,N=ne,j=A,K=J,Q=ae,$=le("permission"),H=de;return p(),I("div",ve,[be,M("div",Ve,[e(N,{gutter:20,justify:"space-between"},{default:l(()=>[e(U,{span:6},{default:l(()=>[x((p(),v(k,{type:"primary",size:"default",plain:"",onClick:n[0]||(n[0]=g=>w())},{default:l(()=>[m(" 添加项目 ")]),_:1})),[[$,"project:add"]])]),_:1}),e(U,{span:18},{default:l(()=>[e(u,{ref:"queryFormRef",inline:"",style:{float:"right"},size:"default",model:r(i)},{default:l(()=>[e(a,{label:"项目/描述",prop:"name"},{default:l(()=>[e(F,{modelValue:r(i).name,"onUpdate:modelValue":n[1]||(n[1]=g=>r(i).name=g),clearable:""},null,8,["modelValue"])]),_:1}),e(a,null,{default:l(()=>[e(k,{type:"primary",onClick:t},{default:l(()=>[m("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),x((p(),v(K,{"element-loading-text":"加载中...",border:"",data:r(z)},{default:l(()=>[e(j,{label:"ID",prop:"id",align:"center",width:"60px"}),e(j,{align:"center",label:"项目名",prop:"name"}),e(j,{align:"center",label:"项目描述",prop:"desc"}),e(j,{align:"center",width:"170px",label:"操作"},{default:l(({row:g})=>[x((p(),v(k,{size:"small",type:"primary",onClick:W=>y(g)},{default:l(()=>[m("编辑 ")]),_:2},1032,["onClick"])),[[$,"project:edit"]]),x((p(),v(k,{size:"small",type:"danger",onClick:W=>C(g)},{default:l(()=>[m(" 删除 ")]),_:2},1032,["onClick"])),[[$,"project:del"]])]),_:1})]),_:1},8,["data"])),[[H,r(V)]]),M("div",ye,[e(Q,{background:"","current-page":r(i).page,"page-sizes":r(o),"page-size":r(i).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:r(d),onSizeChange:r(_),onCurrentChange:r(D)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])]),e(ge,{visible:b.value,"onUpdate:visible":n[2]||(n[2]=g=>b.value=g),formData:c.value,"onUpdate:formData":n[3]||(n[3]=g=>c.value=g),onDone:t},null,8,["visible","formData"])])}}};export{we as default};
